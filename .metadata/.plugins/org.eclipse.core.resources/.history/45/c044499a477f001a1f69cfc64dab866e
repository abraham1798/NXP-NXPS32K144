#include "S32K144.h" /* include peripheral declarations S32K144 */
#define T 4000000

unsigned char duty_cycle=100;
unsigned char espejo_pin;
unsigned char CW=1;

/*
LPIT0_Ch0 = adelante
LPIT0_Ch1 = atras
LPITO_Ch2 = derecha
Lpito_Ch3 = izquierda

Activamos con pulsos el puente h
Motor derecho
7 adelante
15 atras

Motor izquierdo
14 adelante
17 atras

*/

void LPIT0_Ch0_IRQHandler (void)
{
	LPIT0->MSR=1;					//Borrar bandera
	LPIT0->TMR[0].TCTRL&=~(1<<0);  //Escronor en TVAL estando detenido el timer
	PTC->PTOR=(1<<7)+(1<<14);

	if (espejo_pin==1)
	{
		espejo_pin=0;
		LPIT0->TMR[0].TVAL=(((100-(unsigned int)duty_cycle)*T)/100);
	}
	else
	{
		espejo_pin=1;
		LPIT0->TMR[0].TVAL=((((unsigned int)duty_cycle)*T)/100);
	}
	LPIT0->TMR[0].TCTRL|=(1<<0);		//Enable->Trigger
}
